<nz-tabset [nzType]="'card'" [(nzSelectedIndex)]="tabPageIndex" (nzSelectChange)="tabPageChange()" [nzTabBarExtraContent]="navBreakcrumb">
  <nz-tab nzTitle="用户管理" >
    <div class="table-header">
      <span class="operate-text" (click)="addOrEditUserTab(1)">新增</span>
      <span class="operate-text" (click)="deleteUsers(selectedUserIdList)">删除</span>
    </div>
    <div #userListTableWrap class="table-wrap">
      <nz-table nzSize="small" [nzData]="userDataList" #userTable [nzScroll]="{y:userListTableWrap.clientHeight-90 + 'px'}" [nzTotal]="userTableConfig.total" [(nzPageIndex)]="userTableConfig.pageNum"
                [nzBordered]="true" [(nzPageSize)]="userTableConfig.pageSize" [nzFrontPagination]="false" [nzShowQuickJumper]="true"
                [nzLoading]="userTableConfig.loading" (nzPageIndexChange)="getUserList($event)" class="user-table">
        <thead>
          <tr>
            <th  [ngStyle]="{'width':'40px'}" nzShowCheckbox [(nzChecked)]="userTableConfig.allChecked" (nzCheckedChange)="checkUserTableAll($event)" ></th>
            <th [ngStyle]="{'width':'220px'}"><span>操作</span></th>
            <th  *ngFor="let headItem of userTableConfig.header;trackBy:trackByTableHeader" [ngStyle]="{'width':headItem.width}"><span>{{headItem.name}}</span></th>
          </tr>
        </thead>

        <tbody>
          <tr *ngFor="let row of userTable.data;trackBy:trackByUserId;let rowIndex = index;">
            <td [ngStyle]="{'width':'40px'}" nzShowCheckbox [(nzChecked)]="row.checked" (nzCheckedChange)="checkUserTableSingle($event,row)"></td>
            <td [ngStyle]="{'width':'220px'}">
              <span class="operate-text" (click)="resetPd(row)">重置密码</span>
              <span class="operate-text" [ngStyle]="{'color':row.locked === 1?'#ccc':''}" (click)="lockUser(1,row)">锁定</span>
              <span class="operate-text" [ngStyle]="{'color':row.locked === 0?'#ccc':''}" (click)="lockUser(0,row)">启用</span>
              <span class="operate-text" (click)="addOrEditUserTab(2,row)">编辑</span>
              <span class="operate-text" [ngStyle]="{marginRight:'0'}" (click)="deleteUsers([row.userId])">删除</span>
            </td>
            <td *ngFor="let rowFieldName of userTableConfig.header;" [ngStyle]="{'width':rowFieldName.width}">
              <ng-container [ngSwitch]="rowFieldName.field">
                <ng-container *ngSwitchCase="'sex'">
                  <span *ngIf="row[rowFieldName.field] === 0">女</span>
                  <span *ngIf="row[rowFieldName.field] === 1">男</span>
                </ng-container>
                <ng-container *ngSwitchCase="'locked'">
                  <span *ngIf="row[rowFieldName.field] === 0" >启用</span>
                  <span *ngIf="row[rowFieldName.field] === 1" >锁定</span>
                </ng-container>
                <ng-container *ngSwitchCase="'lastLoginTime'">
                  <span>{{row[rowFieldName.field] | date:"y-MM-dd HH:mm:ss"}}</span>
                </ng-container>
                <ng-container *ngSwitchDefault>
                  <span>{{row[rowFieldName.field]}}</span>
                </ng-container>
              </ng-container>
            </td>
          </tr>
        </tbody>

      </nz-table>
    </div>
  </nz-tab>

  <nz-tab *ngIf="tabPageType === 1 || tabPageType === 2" [nzTitle]="addOrEditTitle">
    <div class="edit-add-page">
      <form nz-form [formGroup]="userInfoForm" class="edit-add-form" >
        <nz-form-item>
          <nz-form-label nzSpan="6"><span class="font-red-color">*</span>用户账号</nz-form-label>
          <nz-form-control nzSpan="18">
            <input nz-input formControlName="loginName" nzSize="default" spellcheck="false" maxlength="20" [readonly]="tabPageType===2" />
          </nz-form-control>
        </nz-form-item>
        <nz-form-item>
          <nz-form-label nzSpan="6"><span class="font-red-color">*</span>用户名</nz-form-label>
          <nz-form-control nzSpan="18">
            <input nz-input formControlName="name" nzSize="default" spellcheck="false" maxlength="20" />
          </nz-form-control>
        </nz-form-item>
        <nz-form-item>
          <nz-form-label nzSpan="6">昵称</nz-form-label>
          <nz-form-control nzSpan="18">
            <input nz-input formControlName="nickname" nzSize="default" spellcheck="false" maxlength="20" />
          </nz-form-control>
        </nz-form-item>
        <nz-form-item>
          <nz-form-label nzSpan="6">性别</nz-form-label>
          <nz-form-control  nzSpan="18">
            <nz-radio-group formControlName="sex" >
              <label nz-radio nzValue="1">男</label>
              <label nz-radio nzValue="0">女</label>
            </nz-radio-group>
          </nz-form-control>
        </nz-form-item>
        <nz-form-item>
          <nz-form-label nzSpan="6"><span class="font-red-color">*</span>所属部门</nz-form-label>
          <nz-form-control nzSpan="18">
            <nz-cascader nzPlaceHolder="请选择部门" formControlName="deptId"  (nzVisibleChange)="showDepartment($event)"
                         [nzOptions]="departmentOptions" (nzSelect)="selectDepartmentItem($event)" >
            </nz-cascader>
          </nz-form-control>
        </nz-form-item>
        <nz-form-item>
          <nz-form-label nzSpan="6"><span class="font-red-color">*</span>用户角色</nz-form-label>
          <nz-form-control nzSpan="18">
            <nz-select formControlName="roleIds" nzMode="multiple" nzPlaceHolder="请选择角色,可多选" >
              <nz-option *ngFor="let item of roleIdList;" [nzLabel]="item.name" [nzValue]="item.id"></nz-option>
            </nz-select>
          </nz-form-control>
        </nz-form-item>
        <nz-form-item>
          <nz-form-label nzSpan="6">联系电话</nz-form-label>
          <nz-form-control nzSpan="18">
            <input nz-input formControlName="telephone" nzSize="default" spellcheck="false" />
          </nz-form-control>
        </nz-form-item>
        <nz-form-item>
          <nz-form-label nzSpan="6">手机号</nz-form-label>
          <nz-form-control nzSpan="18">
            <input nz-input formControlName="mobile" nzSize="default" spellcheck="false" />
          </nz-form-control>
        </nz-form-item>
        <nz-form-item>
          <nz-form-label nzSpan="6">电子邮箱</nz-form-label>
          <nz-form-control nzSpan="18">
            <input nz-input formControlName="email" nzSize="default" spellcheck="false" />
          </nz-form-control>
        </nz-form-item>
        <nz-form-item>
          <nz-form-label nzSpan="6">是否锁定</nz-form-label>
          <nz-form-control  nzSpan="18">
            <nz-radio-group formControlName="locked" >
              <label nz-radio nzValue="1">是</label>
              <label nz-radio nzValue="0" >否</label>
            </nz-radio-group>
          </nz-form-control>
        </nz-form-item>
        <nz-form-item>
          <nz-form-label nzSpan="6" class="font-red-color">注</nz-form-label>
          <nz-form-control  nzSpan="18" class="font-red-color">
            新建用户初始密码为：123456
          </nz-form-control>
        </nz-form-item>
      </form>
      <div class="fixed-footer-button-wrap">
        <button nz-button nzType="primary" nzSize="large" (click)="addOrEditSubmit()">保存</button>
        <button nz-button nzType="primary" nzSize="large" nzGhost="true" (click)="toggleManagePage()">取消</button>
      </div>
    </div>
  </nz-tab>


</nz-tabset>
<ng-template #navBreakcrumb>
  <nav-breadcrumb></nav-breadcrumb>
</ng-template>
